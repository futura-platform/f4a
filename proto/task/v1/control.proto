syntax = "proto3";

package task.v1;

import "buf/validate/validate.proto";

message TaskParameters {
  bytes input = 1;
}

message CreateTaskRequest {
  // This value should be randomly generated.
  // This is to reduce hotspots on the database.
  string task_id = 1 [(buf.validate.field).string.max_len = 32];
  string executor_id = 2;
  string callback_url = 3;
  TaskParameters parameters = 4;
  // todo: add the ability to connect this task to a trace
}
message CreateTaskResponse {}

message UpdateTaskRequest {
  string task_id = 1;
  TaskParameters parameters = 2;
}
message UpdateTaskResponse {}

message ActivateTaskRequest {
  string task_id = 1;
}
message ActivateTaskResponse {}

message SuspendTaskRequest {
  string task_id = 1;
}
message SuspendTaskResponse {}

message DeleteTaskRequest {
  string task_id = 1;
}
message DeleteTaskResponse {}

service ControlService {
  // CreateTask creates a new task and returns the task ID.
  // The task will be created in the suspended state.
  // if the task_id is already in use, this will do nothing.
  rpc CreateTask(CreateTaskRequest) returns (CreateTaskResponse);

  // UpdateTask updates the parameters of a task.
  // This can be used on a task that is in any state.
  rpc UpdateTask(UpdateTaskRequest) returns (UpdateTaskResponse);

  // ActivateTask "activates" a task that is in the suspended state.
  // If the task is in the running state, this will do nothing.
  // Otherwise, this will set the task to the pending state.
  // It will be executed by a runner as soon as possible.
  rpc ActivateTask(ActivateTaskRequest) returns (ActivateTaskResponse);

  // SuspendTask suspends a task that is in the pending or running state.
  // If the task is in the suspended state, this will do nothing.
  // This will set the task to the suspended state.
  // It will stop execution as soon as possible.
  rpc SuspendTask(SuspendTaskRequest) returns (SuspendTaskResponse);

  // DeleteTask deletes a task.
  // This will remove the task from the system.
  // This can be used on a task that is in any state.
  // if the task_id does not exist, this will do nothing.
  rpc DeleteTask(DeleteTaskRequest) returns (DeleteTaskResponse);
}
