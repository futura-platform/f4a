# Metrics server for pod resource metrics (used by dispatch for load balancing)
metrics-server:
  enabled: true
  args:
    - --kubelet-insecure-tls # Required for minikube/local clusters

foundationdb:
  clusterName: serpmonitor
  spec:
    version: 7.3.63
    automationOptions:
      replacements:
        enabled: true
    faultDomain:
      key: foundationdb.org/none
    imageType: split
    labels:
      matchLabels:
        foundationdb.org/fdb-cluster-name: serpmonitor
      processClassLabels:
        - foundationdb.org/fdb-process-class
      processGroupIDLabels:
        - foundationdb.org/fdb-process-group-id
    minimumUptimeSecondsForBounce: 60
    processCounts:
      cluster_controller: 1
      stateless: -1
    processes:
      general:
        customParameters:
          - knob_disable_posix_kernel_aio=1
        podTemplate:
          spec:
            containers:
              - name: foundationdb
                resources:
                  requests:
                    cpu: 100m
                    memory: 128Mi
                securityContext:
                  runAsUser: 0
              - name: foundationdb-kubernetes-sidecar
                resources:
                  limits:
                    cpu: 100m
                    memory: 128Mi
                  requests:
                    cpu: 100m
                    memory: 128Mi
                securityContext:
                  runAsUser: 0
            initContainers:
              - name: foundationdb-kubernetes-init
                resources:
                  limits:
                    cpu: 100m
                    memory: 128Mi
                  requests:
                    cpu: 100m
                    memory: 128Mi
                securityContext:
                  runAsUser: 0
        volumeClaimTemplate:
          spec:
            resources:
              requests:
                storage: 16G
    routing:
      defineDNSLocalityFields: true
    sidecarContainer:
      enableLivenessProbe: true

f4a-runner:
  gateway:
    image: f4a-gateway:latest
  dispatch:
    image: f4a-dispatch:latest
  worker:
    image: serpmonitor:latest
  fdb:
    clusterFile:
      # Secret created by fdb-secret-sync job from the operator's ConfigMap
      secret:
        name: serpmonitor-cluster-file
        key: fdb.cluster
      writable:
        enabled: true
        mountPath: /etc/foundationdb
        sourceMountPath: /etc/foundationdb-source
        initImage: foundationdb/fdb-kubernetes-monitor:7.3.63
